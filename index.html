<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Χάρτης Πάρνηθας - AI Edition</title>
    
    <!-- PWA SETTINGS -->
    <meta name="theme-color" content="#2e7d32">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Parnitha Map">
    
    <link rel="apple-touch-icon" href="https://lh3.googleusercontent.com/a-/ALV-UjUCO8MgQJshwSQ6QbDEBjR4OLVCwN3-3eB3-9L4XwPCvNf2YM4=s265-w265-h265">
    <link rel="icon" type="image/png" href="https://lh3.googleusercontent.com/a-/ALV-UjUCO8MgQJshwSQ6QbDEBjR4OLVCwN3-3eB3-9L4XwPCvNf2YM4=s265-w265-h265">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { margin: 0; padding: 0; font-family: 'Roboto', sans-serif; background-color: #f0f2f5; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        #map { width: 100%; height: 100vh; z-index: 1; cursor: grab; }
        #map.adding-point { cursor: crosshair; }

        /* --- COMPASS STYLE --- */
        .compass-container {
            position: absolute;
            bottom: 120px; right: 20px;
            z-index: 900; width: 60px; height: 60px;
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            border-radius: 50%;
            box-shadow: 5px 5px 10px #bfbfbf, -5px -5px 10px #ffffff, inset 0 0 2px rgba(0,0,0,0.1);
            border: 2px solid #fff;
            display: flex; justify-content: center; align-items: center; pointer-events: none;
        }
        .compass-face { position: relative; width: 100%; height: 100%; border-radius: 50%; }
        .compass-mark { position: absolute; font-size: 10px; font-weight: bold; color: #555; font-family: 'Arial', sans-serif; }
        .compass-mark.n { top: 4px; left: 50%; transform: translateX(-50%); color: #e74c3c; }
        .compass-mark.s { bottom: 4px; left: 50%; transform: translateX(-50%); }
        .compass-mark.e { right: 5px; top: 50%; transform: translateY(-50%); }
        .compass-mark.w { left: 5px; top: 50%; transform: translateY(-50%); }
        .compass-needle {
            position: absolute; top: 50%; left: 50%; width: 4px; height: 40px; background: transparent;
            transform-origin: center center; transform: translate(-50%, -50%) rotate(0deg);
            transition: transform 0.2s cubic-bezier(0.4, 2.08, 0.55, 0.44);
        }
        .compass-needle::before {
            content: ''; position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 4px solid transparent; border-right: 4px solid transparent; border-bottom: 20px solid #e74c3c;
            transform: translate(-2px, -2px);
        }
        .compass-needle::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 0;
            border-left: 4px solid transparent; border-right: 4px solid transparent; border-top: 20px solid #333;
            transform: translate(-2px, 2px);
        }
        .compass-center {
            position: absolute; top: 50%; left: 50%; width: 8px; height: 8px; background: silver;
            border-radius: 50%; transform: translate(-50%, -50%); box-shadow: 0 1px 2px rgba(0,0,0,0.3); z-index: 2;
        }

        /* --- 3D BUTTON STYLES --- */
        .control-btn, .ai-analyze-btn, .dropdown-item, .settings-save-btn, .delete-marker-btn, .rec-btn {
            border: none; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: bold;
            display: inline-flex; align-items: center; justify-content: center; gap: 6px;
            position: relative; transition: all 0.1s ease; outline: none; text-transform: uppercase;
            letter-spacing: 0.5px; padding: 8px 14px; box-shadow: 0 4px 0 rgba(0,0,0,0.2); transform: translateY(0);
        }
        .control-btn:active, .ai-analyze-btn:active, .dropdown-item:active, .settings-save-btn:active, .rec-btn:active {
            transform: translateY(4px); box-shadow: 0 0 0 rgba(0,0,0,0.2);
        }

        .control-btn { background: #ffffff; color: #333; border: 1px solid #e0e0e0; border-bottom-color: #bdc3c7; }
        .btn-gps-main { background: #3498db; color: white; border-color: #2980b9; border-bottom-color: #1f6391; box-shadow: 0 4px 0 #1f6391; }
        .btn-gps-main.active { background: #2ecc71; border-color: #27ae60; border-bottom-color: #1e8449; box-shadow: 0 4px 0 #1e8449; }
        .btn-gps-main.searching { background: #f39c12; border-color: #d68910; border-bottom-color: #b9770e; box-shadow: 0 4px 0 #b9770e; animation: pulse-orange 1.5s infinite; }
        @keyframes pulse-orange { 0% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(243, 156, 18, 0); } 100% { box-shadow: 0 0 0 0 rgba(243, 156, 18, 0); } }
        
        .btn-add-point { background: #e67e22; color: white; border-color: #d35400; border-bottom-color: #a04000; box-shadow: 0 4px 0 #a04000; }
        .btn-add-point.active { background: #c0392b; border-color: #922b21; box-shadow: 0 4px 0 #641e16; }
        .btn-save-html { background: #16a085; color: white; border-color: #1abc9c; border-bottom-color: #0e6655; box-shadow: 0 4px 0 #0e6655; }
        .btn-share-main { background: #9b59b6; color: white; border-color: #8e44ad; border-bottom-color: #6c3483; box-shadow: 0 4px 0 #6c3483; }
        /* Κουμπί Install PWA */
        .btn-install { background: #2c3e50; color: white; border-color: #34495e; border-bottom-color: #1a252f; box-shadow: 0 4px 0 #1a252f; display: none; }

        .ai-analyze-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; box-shadow: 0 4px 0 #4a3b75; }

        /* Dropdown Menu */
        .dropdown-container { position: relative; display: inline-block; }
        .dropdown-menu { display: none; position: absolute; top: 120%; right: 0; background-color: white; min-width: 180px; box-shadow: 0 8px 16px rgba(0,0,0,0.2); z-index: 2000; border-radius: 8px; border: 1px solid #eee; padding: 5px; flex-direction: column; gap: 5px; }
        .dropdown-menu.show { display: flex; animation: fadeIn 0.2s; }
        .dropdown-item { width: 100%; text-align: left; justify-content: flex-start; background: white; color: #333; border: 1px solid #eee; border-bottom: 2px solid #ddd; box-shadow: none; padding: 8px; margin-bottom: 2px; }
        .dropdown-item:hover { background-color: #f8f9fa; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* RECORDING DASHBOARD */
        .recording-dashboard { display: none; position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 600px; background: rgba(255, 255, 255, 0.95); border-radius: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.2); z-index: 4000; padding: 15px; flex-direction: column; border-bottom: 5px solid #e74c3c; }
        .rec-stats { display: flex; justify-content: space-between; margin-bottom: 15px; background: #f8f9fa; padding: 10px; border-radius: 10px; }
        .rec-stat-item { text-align: center; flex: 1; border-right: 1px solid #ddd; }
        .rec-stat-item:last-child { border-right: none; }
        .rec-val { font-family: 'Orbitron', monospace; font-size: 18px; font-weight: bold; color: #333; display: block;}
        .rec-label { font-size: 10px; color: #666; text-transform: uppercase; }
        .rec-controls { display: flex; gap: 10px; justify-content: center; }
        .rec-btn-stop { background: #c0392b; color: white; border-bottom-color: #922b21; box-shadow: 0 4px 0 #922b21; flex: 1;}
        .rec-btn-pause { background: #f39c12; color: white; border-bottom-color: #d68910; box-shadow: 0 4px 0 #d68910; flex: 1;}
        .rec-btn-pause.resume { background: #27ae60; border-